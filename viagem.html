<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist de Viagem - Família Donato Suarez</title>
    <style>
        :root {
            --bg: #f4f7f6;
            --text: #333;
            --card-bg: #ffffff;
            --primary: #2c3e50;
            --accent: #3498db;
            --danger: #e74c3c;
            --success: #2ecc71;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #1a1a1a;
                --text: #e0e0e0;
                --card-bg: #2d2d2d;
                --primary: #ecf0f1;
                --accent: #3498db;
            }
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .header {
            width: 100%;
            max-width: 600px;
            text-align: center;
            margin-bottom: 20px;
        }
        .nav-link {
            text-decoration: none;
            color: var(--accent);
            font-size: 0.9rem;
            margin-bottom: 10px;
            display: inline-block;
        }
        .progress-container {
            width: 100%;
            background: #ddd;
            border-radius: 10px;
            margin: 20px 0;
            height: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s ease;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }
        .btn-filter { background: var(--accent); color: white; }
        .btn-reset { background: var(--danger); color: white; }
        
        .category-section {
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        .category-title {
            font-size: 1.2rem;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 5px;
            margin-bottom: 10px;
            color: var(--accent);
        }
        .item {
            background: var(--card-bg);
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.1s;
        }
        .item:active { transform: scale(0.98); }
        .item.checked {
            opacity: 0.6;
        }
        .item.checked span {
            text-decoration: line-through;
        }
        .item input {
            margin-right: 15px;
            transform: scale(1.2);
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" class="nav-link">← Voltar para Início</a>
        <h1>Checklist de Viagem</h1>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <p id="progressText">0% concluído</p>
        
        <div class="controls">
            <button class="btn-filter" onclick="toggleFilter()" id="filterBtn">Ocultar Riscados</button>
            <button class="btn-reset" onclick="resetList()">Zerar Lista</button>
        </div>
    </div>

    <div id="listContainer" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        <!-- Categories will be injected here -->
    </div>

    <script>
        let listData = [];
        let hideChecked = false;

        async function loadData() {
            try {
                const response = await fetch('data/viagem.json?t=' + Date.now());
                listData = await response.json();
                renderList();
            } catch (e) {
                console.error("Erro ao carregar dados", e);
            }
        }

        function renderList() {
            const container = document.getElementById('listContainer');
            container.innerHTML = '';
            
            const categories = [...new Set(listData.map(i => i.categoria))];
            
            categories.forEach(cat => {
                const section = document.createElement('div');
                section.className = 'category-section';
                section.innerHTML = `<div class="category-title">${cat}</div>`;
                
                const items = listData.filter(i => i.categoria === cat);
                let visibleItemsCount = 0;

                items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `item ${item.checked ? 'checked' : ''}`;
                    if (hideChecked && item.checked) itemDiv.classList.add('hidden');
                    else visibleItemsCount++;

                    itemDiv.onclick = () => toggleItem(item.item);
                    itemDiv.innerHTML = `
                        <input type="checkbox" ${item.checked ? 'checked' : ''}>
                        <span>${item.item}</span>
                    `;
                    section.appendChild(itemDiv);
                });

                if (visibleItemsCount > 0 || !hideChecked) {
                    container.appendChild(section);
                }
            });

            updateProgress();
        }

        function toggleItem(itemName) {
            const item = listData.find(i => i.item === itemName);
            if (item) {
                item.checked = !item.checked;
                renderList();
                saveData();
            }
        }

        function updateProgress() {
            const total = listData.length;
            const checked = listData.filter(i => i.checked).length;
            const percent = Math.round((checked / total) * 100);
            
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').innerText = `${percent}% concluído (${checked}/${total})`;
        }

        function toggleFilter() {
            hideChecked = !hideChecked;
            document.getElementById('filterBtn').innerText = hideChecked ? 'Mostrar Todos' : 'Ocultar Riscados';
            renderList();
        }

        function resetList() {
            if (confirm("Tem certeza que deseja zerar toda a lista para uma nova viagem?")) {
                listData.forEach(i => i.checked = false);
                renderList();
                saveData();
            }
        }

        async function saveData() {
            // Nota: No ambiente do GitHub Pages, o salvamento via fetch POST não funciona.
            // O agente OpenClaw detectará mudanças no estado da sessão ou comandos via chat
            // para atualizar o JSON no servidor. No dashboard, salvamos temporariamente no localStorage
            // para feedback imediato se necessário, mas o "Source of Truth" é o JSON que o agente edita.
            console.log("Dados prontos para salvar via Agente");
        }

        loadData();
    </script>
</body>
</html>
